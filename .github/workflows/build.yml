steps:
  - uses: actions/checkout@v4
    with:
      submodules: recursive

  - name: Set up Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '18'
      cache: 'npm'

  # Install root deps (Wails) - SKIPS prepare script due to --ignore-scripts
  - name: Install root dependencies
    run: npm install --ignore-scripts

  # Install frontend deps (Next.js)
  - name: Install frontend dependencies
    run: npm install
    working-directory: frontend

  # Build frontend
  - name: Build frontend
    run: npm run build
    working-directory: frontend

  - uses: dAppServer/wails-build-action@main
    with:
      build-name: ${{ matrix.build.name }}
      build-platform: ${{ matrix.build.platform }}
      wails-version: "v2.9.0"
